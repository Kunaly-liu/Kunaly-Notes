# Javaç½‘ç»œç¼–ç¨‹

[æœ¬æ–‡ç›¸å…³ä»£ç ](https://gitee.com/kunaly/kunaly-notes/raw/main/docs/Java/Java%E5%9F%BA%E7%A1%80/Codes/NetDemo.zip)

## 1.  æ¦‚è¿°

### 1.1  è®¡ç®—æœºç½‘ç»œç®€ä»‹

ã€€è®¡ç®—æœºç½‘ç»œæ˜¯é€šè¿‡ä¼ è¾“ä»‹è´¨ã€é€šä¿¡è®¾æ–½å’Œç½‘ç»œé€šä¿¡åè®®ï¼ŒæŠŠåˆ†æ•£åœ¨ä¸åŒåœ°ç‚¹çš„è®¡ç®—æœºè®¾å¤‡äº’è¿èµ·æ¥çš„ï¼Œå®ç°èµ„æºå…±äº«å’Œæ•°æ®ä¼ è¾“çš„ç³»ç»Ÿã€‚ç½‘ç»œç¼–ç¨‹å°±æ˜¯ç¼–å†™ç¨‹åºä½¿äº’è”ç½‘çš„ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰è®¾å¤‡ï¼ˆå¦‚è®¡ç®—æœºï¼‰ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚Javaè¯­è¨€å¯¹ç½‘ç»œç¼–ç¨‹æä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚é€šè¿‡å…¶æä¾›çš„æ¥å£æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œç½‘ç»œç¼–ç¨‹ã€‚

### 1.2  ç½‘ç»œåˆ†å±‚

â€‹		é€šè¿‡ç½‘ç»œå‘é€æ•°æ®æ˜¯ä¸€é¡¹å¤æ‚çš„æ“ä½œï¼Œå¿…é¡»ä»”ç»†åœ°åè°ƒç½‘ç»œçš„ç‰©ç†ç‰¹æ€§ä»¥åŠæ‰€å‘é€æ•°æ®çš„é€»è¾‘ç‰¹å¾ã€‚é€šè¿‡ç½‘ç»œå°†æ•°æ®ä»ä¸€å°ä¸»æœºå‘é€åˆ°å¦å¤–çš„ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡è®¡ç®—æœºç½‘ç»œé€šä¿¡æ¥å®Œæˆã€‚

ã€€ã€€ç½‘ç»œé€šä¿¡çš„ä¸åŒæ–¹é¢è¢«åˆ†è§£ä¸ºå¤šä¸ªå±‚ï¼Œå±‚ä¸å±‚ä¹‹é—´ç”¨æ¥å£è¿æ¥ã€‚é€šä¿¡çš„åŒæ–¹å…·æœ‰ç›¸åŒçš„å±‚æ¬¡ï¼Œå±‚æ¬¡å®ç°çš„åŠŸèƒ½ç”±åè®®æ•°æ®å•å…ƒï¼ˆPDUï¼‰æ¥æè¿°ã€‚ä¸åŒç³»ç»Ÿä¸­çš„åŒä¸€å±‚æ„æˆå¯¹ç­‰å±‚ï¼Œå¯¹ç­‰å±‚ä¹‹é—´é€šè¿‡å¯¹ç­‰å±‚åè®®è¿›è¡Œé€šä¿¡ï¼Œç†è§£æ‰¹æ¬¡å®šä¹‰å¥½çš„è§„åˆ™å’Œçº¦å®šã€‚æ¯ä¸€å±‚è¡¨ç¤ºä¸ºç‰©ç†ç¡¬ä»¶ï¼ˆå³çº¿ç¼†å’Œç”µæµï¼‰ä¸æ‰€ä¼ è¾“ä¿¡æ¯ä¹‹é—´çš„ä¸åŒæŠ½è±¡å±‚æ¬¡ã€‚åœ¨ç†è®ºä¸Šï¼Œæ¯ä¸€å±‚åªä¸ç´§æŒ¨å…¶ä¸Šå’Œå…¶ä¸‹çš„å±‚å¯¹è¯ã€‚å°†ç½‘ç»œåˆ†å±‚ï¼Œè¿™æ ·å°±å¯ä»¥ä¿®æ”¹ç”šè‡³æ›¿æ¢æŸä¸€å±‚çš„è½¯ä»¶ï¼Œåªè¦å±‚ä¸å±‚ä¹‹é—´çš„æ¥å£ä¿æŒä¸å˜ï¼Œå°±ä¸ä¼šå½±å“åˆ°å…¶ä»–å±‚ã€‚

ã€€ã€€è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„æ˜¯è®¡ç®—æœºç½‘ç»œå±‚æ¬¡å’Œåè®®çš„é›†åˆï¼Œç½‘ç»œä½“ç³»ç»“æ„å¯¹è®¡ç®—æœºç½‘ç»œå®ç°çš„åŠŸèƒ½ï¼Œä»¥åŠç½‘ç»œåè®®ã€å±‚æ¬¡ã€æ¥å£å’ŒæœåŠ¡è¿›è¡Œäº†æè¿°ï¼Œä½†å¹¶ä¸æ¶‰åŠå…·ä½“çš„å®ç°ã€‚æ¥å£æ˜¯åŒä¸€èŠ‚ç‚¹å†…ç›¸é‚»å±‚ä¹‹é—´äº¤æ¢ä¿¡æ¯çš„è¿æ¥å¤„ï¼Œä¹Ÿå«æœåŠ¡è®¿é—®ç‚¹ï¼ˆSAPï¼‰ã€‚

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190503122042374-56172361.png)



ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªç½‘ç»œä½“ç³»ç»“æ„ç”±IBMå…¬å¸æå‡ºï¼ˆ1974å¹´ï¼ŒSNAï¼‰ï¼Œä»¥åå…¶ä»–å…¬å¸ä¹Ÿç›¸ç»§æå‡ºè‡ªå·±çš„ç½‘ç»œä½“ç³»ç»“æ„ã€‚ä¸ºäº†ä¿ƒè¿›è®¡ç®—æœºç½‘ç»œçš„å‘å±•ï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ISOåœ¨ç°æœ‰ç½‘ç»œçš„åŸºç¡€ä¸Šï¼Œæå‡ºäº†ä¸åŸºäºå…·ä½“æœºå‹ã€æ“ä½œç³»ç»Ÿæˆ–å…¬å¸çš„ç½‘ç»œä½“ç³»ç»“æ„ï¼Œç§°ä¸ºå¼€æ”¾ç³»ç»Ÿäº’è¿å‚è€ƒæ¨¡å‹ï¼Œå³OSI/RMï¼ˆOpen System Interconnection Reference Modelï¼‰ã€‚

ã€€ã€€ISOåˆ¶å®šçš„OSIå‚è€ƒæ¨¡å‹è¿‡äºåºå¤§ã€å¤æ‚æ‹›è‡´äº†è®¸å¤šæ‰¹è¯„ã€‚ä¸æ­¤ç›¸å¯¹ï¼Œç¾å›½å›½é˜²éƒ¨æå‡ºäº†TCP/IPåè®®æ ˆå‚è€ƒæ¨¡å‹ï¼Œç®€åŒ–äº†OSIå‚è€ƒæ¨¡å‹ï¼Œç”±äºTCP/IPåè®®æ ˆçš„ç®€å•ï¼Œè·å¾—äº†å¹¿æ³›çš„åº”ç”¨ï¼Œå¹¶æˆä¸ºåç»­å› ç‰¹ç½‘ä½¿ç”¨çš„å‚è€ƒæ¨¡å‹ã€‚

### 1.3 OSIå‚è€ƒæ¨¡å‹

OSIæ¨¡å‹æŠŠç½‘ç»œé€šä¿¡çš„å·¥ä½œåˆ†ä¸º7å±‚ï¼Œåˆ†åˆ«æ˜¯ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚å’Œåº”ç”¨å±‚ã€‚

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/54fbb2fb43166d2259d200b3442309f79052d26b)

å„å±‚çš„ä½œç”¨ï¼š

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1639925-20191106134509444-1655245651.png)

- ç‰©ç†å±‚

ã€€ã€€ç‰©ç†å±‚å¤„äºOSIçš„æœ€åº•å±‚ï¼Œæ˜¯æ•´ä¸ªå¼€æ”¾ç³»ç»Ÿçš„åŸºç¡€ã€‚ç‰©ç†å±‚æ¶‰åŠé€šä¿¡ä¿¡é“ä¸Šä¼ è¾“çš„åŸå§‹æ¯”ç‰¹æµï¼ˆbitsï¼‰ï¼Œå®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯ä¸ºæ•°æ®ç«¯è®¾å¤‡æä¾›ä¼ é€æ•°æ®çš„é€šè·¯ä»¥åŠä¼ è¾“æ•°æ®ã€‚

- æ•°æ®é“¾è·¯å±‚

ã€€ã€€æ•°æ®é“¾è·¯å±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯å®ç°è®¡ç®—æœºç½‘ç»œä¸­ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´çš„å¯é ä¼ è¾“ï¼ŒæŠŠåŸå§‹çš„ã€æœ‰å·®é”™çš„ç‰©ç†ä¼ è¾“çº¿åŠ ä¸Šæ•°æ®é“¾è·¯åè®®ä»¥åï¼Œæ„æˆé€»è¾‘ä¸Šå¯é çš„æ•°æ®é“¾è·¯ã€‚éœ€è¦å®Œæˆçš„åŠŸèƒ½æœ‰é“¾è·¯ç®¡ç†ã€æˆå¸§ã€å·®é”™æ§åˆ¶ä»¥åŠæµé‡æ§åˆ¶ç­‰ã€‚å…¶ä¸­æˆå¸§æ˜¯å¯¹ç‰©ç†å±‚çš„åŸå§‹æ¯”ç‰¹æµè¿›è¡Œç•Œå®šï¼Œæ•°æ®é“¾è·¯å±‚ä¹Ÿèƒ½å¤Ÿå¯¹å¸§çš„ä¸¢å¤±è¿›è¡Œå¤„ç†ã€‚

- ç½‘ç»œå±‚

ã€€ã€€ç½‘ç»œå±‚æ¶‰åŠæºä¸»æœºèŠ‚ç‚¹åˆ°ç›®çš„ä¸»æœºèŠ‚ç‚¹ä¹‹é—´å¯é çš„ç½‘ç»œä¼ è¾“ï¼Œå®ƒéœ€è¦å®Œæˆçš„åŠŸèƒ½ä¸»è¦åŒ…æ‹¬è·¯ç”±é€‰æ‹©ã€ç½‘ç»œå¯»å€ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€ç½‘ç»œäº’è¿ç­‰ã€‚

- ä¼ è¾“å±‚

ã€€ã€€ä¼ è¾“å±‚èµ·ç€æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œæ¶‰åŠæºç«¯èŠ‚ç‚¹åˆ°ç›®çš„ç«¯èŠ‚ç‚¹ä¹‹é—´å¯é çš„ä¿¡æ¯ä¼ è¾“ã€‚ä¼ è¾“å±‚éœ€è¦è§£å†³è·¨è¶Šç½‘ç»œè¿æ¥çš„å»ºç«‹å’Œé‡Šæ”¾ï¼Œå¯¹åº•å±‚ä¸å¯é çš„ç½‘ç»œï¼Œå»ºç«‹è¿æ¥æ—¶éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‡Šæ”¾è¿æ¥æ—¶éœ€è¦å››æ¬¡æŒ¥æ‰‹ã€‚ã€€ã€€

- ä¼šè¯å±‚å’Œè¡¨ç¤ºå±‚

ã€€ã€€ä¼šè¯å±‚çš„ä¸»è¦åŠŸèƒ½æ˜¯è´Ÿè´£åº”ç”¨ç¨‹åºä¹‹é—´å»ºç«‹ã€ç»´æŒå’Œä¸­æ–­ä¼šè¯ï¼ŒåŒæ—¶ä¹Ÿæä¾›å¯¹è®¾å¤‡å’Œç»“ç‚¹ä¹‹é—´çš„ä¼šè¯æ§åˆ¶ï¼Œåè°ƒç³»ç»Ÿå’ŒæœåŠ¡ä¹‹é—´çš„äº¤æµï¼Œå¹¶é€šè¿‡æä¾›å•å·¥ã€åŠåŒå·¥å’Œå…¨åŒå·¥3ç§ä¸åŒçš„é€šä¿¡æ–¹å¼ï¼Œä½¿ç³»ç»Ÿå’ŒæœåŠ¡ä¹‹é—´æœ‰åºåœ°è¿›è¡Œé€šä¿¡ã€‚

ã€€ã€€è¡¨ç¤ºå±‚å…³å¿ƒæ‰€ä¼ è¾“æ•°æ®ä¿¡æ¯çš„æ ¼å¼å®šä¹‰ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯æŠŠåº”ç”¨å±‚æä¾›çš„ä¿¡æ¯å˜æ¢ä¸ºèƒ½å¤Ÿå…±åŒç†è§£çš„å½¢å¼ï¼Œæä¾›å­—ç¬¦ä»£ç ã€æ•°æ®æ ¼å¼ã€æ§åˆ¶ä¿¡æ¯æ ¼å¼ã€åŠ å¯†ç­‰çš„ç»Ÿä¸€è¡¨ç¤ºã€‚

- åº”ç”¨å±‚

ã€€ã€€åº”ç”¨å±‚ä¸ºOSIçš„æœ€é«˜å±‚ï¼Œæ˜¯ç›´æ¥ä¸ºåº”ç”¨è¿›ç¨‹æä¾›æœåŠ¡çš„ã€‚å…¶ä½œç”¨æ˜¯åœ¨å®ç°å¤šä¸ªç³»ç»Ÿåº”ç”¨è¿›ç¨‹ç›¸äº’é€šä¿¡çš„åŒæ—¶ï¼Œå®Œæˆä¸€ç³»åˆ—ä¸šåŠ¡å¤„ç†æ‰€éœ€çš„æœåŠ¡ã€‚

### 1.4 TCP/IPå‚è€ƒæ¨¡å‹

ã€€TCP/IPï¼Œå³Transmission Control Protocol/Internet Protocolçš„ç®€å†™ï¼Œä¸­è¯‘åä¸ºä¼ è¾“æ§åˆ¶åè®®/å› ç‰¹ç½‘äº’è”åè®®ï¼Œæ˜¯Internetæœ€åŸºæœ¬çš„åè®®ï¼ŒInternetå›½é™…äº’è”ç½‘ç»œçš„åŸºç¡€ã€‚

ã€€ã€€TCP/IPåè®®æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ç½‘ç»œåè®®ç°‡ï¼Œå®ƒçš„åå­—ä¸»è¦å–è‡ªæœ€é‡è¦çš„ç½‘ç»œå±‚IPåè®®å’Œä¼ è¾“å±‚TCPåè®®ã€‚TCP/IPåè®®å®šä¹‰äº†ç”µå­è®¾å¤‡å¦‚ä½•è¿å…¥å› ç‰¹ç½‘ï¼Œä»¥åŠæ•°æ®å¦‚ä½•åœ¨å®ƒä»¬ä¹‹é—´ä¼ è¾“çš„æ ‡å‡†ã€‚TCP/IPå‚è€ƒæ¨¡å‹é‡‡ç”¨4å±‚çš„å±‚çº§ç»“æ„ï¼Œæ¯ä¸€å±‚éƒ½å‘¼å«å®ƒçš„ä¸‹ä¸€å±‚æ‰€æä¾›çš„åè®®æ¥å®Œæˆè‡ªå·±çš„éœ€æ±‚ï¼Œè¿™4ä¸ªå±‚æ¬¡åˆ†åˆ«æ˜¯ï¼šç½‘ç»œæ¥å£å±‚ã€ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰ã€ä¼ è¾“å±‚ï¼ˆTCPå±‚ï¼‰ã€åº”ç”¨å±‚ã€‚

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1e30e924b899a9012db25350c05fa87d0308f526.jpeg)

- ç½‘ç»œæ¥å£å±‚

ã€€ã€€TCP/IPåè®®å¯¹ç½‘ç»œæ¥å£å±‚æ²¡æœ‰ç»™å‡ºå…·ä½“çš„æè¿°ï¼Œç½‘ç»œæ¥å£å±‚å¯¹åº”ç€OSIå‚è€ƒæ¨¡å‹çš„ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚

- ç½‘ç»œå±‚ï¼ˆIPå±‚ï¼‰

ã€€ã€€ç½‘ç»œå±‚æ˜¯æ•´ä¸ªTCP/IPåè®®æ ˆçš„æ ¸å¿ƒã€‚å®ƒçš„åŠŸèƒ½æ˜¯æŠŠåˆ†ç»„å‘å¾€ç›®æ ‡ç½‘ç»œæˆ–ä¸»æœºã€‚åŒæ—¶ï¼Œä¸ºäº†å°½å¿«åœ°å‘é€åˆ†ç»„ï¼Œå¯èƒ½éœ€è¦æ²¿ä¸åŒçš„è·¯å¾„åŒæ—¶è¿›è¡Œåˆ†ç»„ä¼ é€’ã€‚å› æ­¤ï¼Œåˆ†ç»„åˆ°è¾¾çš„é¡ºåºå’Œå‘é€çš„é¡ºåºå¯èƒ½ä¸åŒï¼Œè¿™å°±éœ€è¦ä¸Šå±‚å¿…é¡»å¯¹åˆ†ç»„è¿›è¡Œæ’åºã€‚ç½‘ç»œå±‚é™¤äº†éœ€è¦å®Œæˆè·¯ç”±çš„åŠŸèƒ½å¤–ï¼Œä¹Ÿå¯ä»¥å®Œæˆå°†ä¸åŒç±»å‹çš„ç½‘ç»œï¼ˆå¼‚æ„ç½‘ï¼‰äº’è¿çš„ä»»åŠ¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œäº’è”ç½‘å±‚è¿˜éœ€è¦å®Œæˆæ‹¥å¡æ§åˆ¶çš„åŠŸèƒ½ã€‚

- ä¼ è¾“å±‚ï¼ˆTCPå±‚ï¼‰

ã€€ã€€TCPå±‚è´Ÿè´£åœ¨åº”ç”¨è¿›ç¨‹ä¹‹é—´å»ºç«‹ç«¯åˆ°ç«¯çš„è¿æ¥å’Œå¯é é€šä¿¡ï¼Œå®ƒåªå­˜åœ¨ä¸ç«¯èŠ‚ç‚¹ä¸­ã€‚TCPå±‚æ¶‰åŠä¸¤ä¸ªåè®®ï¼ŒTCPå’ŒUDPã€‚å…¶ä¸­ï¼ŒTCPåè®®æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ï¼Œæä¾›æŒ‰å­—èŠ‚æµçš„æœ‰åºã€å¯é ä¼ è¾“ï¼Œå¯ä»¥å®ç°è¿æ¥ç®¡ç†ã€å·®é”™æ§åˆ¶ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ç­‰ã€‚UDPåè®®æä¾›æ— è¿æ¥çš„æœåŠ¡ï¼Œç”¨äºä¸éœ€è¦æˆ–æ— æ³•å®ç°é¢å‘è¿æ¥çš„ç½‘ç»œåº”ç”¨ä¸­ã€‚

- åº”ç”¨å±‚

ã€€ã€€åº”ç”¨å±‚ä¸ºInternetä¸­çš„å„ç§ç½‘ç»œåº”ç”¨æä¾›æœåŠ¡ã€‚

### 1.5 ç½‘ç»œåè®®

ã€€å¦‚åŒäººä¸äººä¹‹é—´ç›¸äº’äº¤æµæ˜¯éœ€è¦éµå¾ªä¸€å®šçš„è§„åˆ™ï¼ˆå¦‚è¯­è¨€ï¼‰ä¸€æ ·ï¼Œè®¡ç®—æœºä¹‹é—´èƒ½å¤Ÿè¿›è¡Œç›¸äº’é€šä¿¡æ˜¯å› ä¸ºå®ƒä»¬éƒ½å…±åŒéµå®ˆä¸€å®šçš„è§„åˆ™ï¼Œå³ç½‘ç»œåè®®ã€‚

ã€€ã€€OSIå‚è€ƒæ¨¡å‹å’ŒTCP/IPæ¨¡å‹åœ¨ä¸åŒçš„å±‚æ¬¡ä¸­æœ‰è®¸å¤šä¸åŒçš„ç½‘ç»œåè®®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190503164338008-348345936.png)

ç½‘ç»œåè®®ä¹‹é—´çš„å…³ç³»å›¾å¦‚ä¸‹ï¼š

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190503165942538-1220277464.png)



####  1.5.1 IPåè®®ï¼ˆInternet protocolï¼‰

 ã€€IPåè®®çš„ä½œç”¨åœ¨äºæŠŠå„ç§æ•°æ®åŒ…å‡†å¤‡æ— è¯¯çš„ä¼ é€’ç»™å¯¹æ–¹ï¼Œå…¶ä¸­ä¸¤ä¸ªé‡è¦çš„æ¡ä»¶æ˜¯IPåœ°å€å’ŒMACåœ°å€ã€‚ç”±äºIPåœ°å€æ˜¯ç¨€æœ‰èµ„æºï¼Œä¸å¯èƒ½æ¯ä¸ªäººéƒ½æ‹¥æœ‰ä¸€ä¸ªIPåœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸çš„IPåœ°å€æ˜¯è·¯ç”±å™¨ç»™æˆ‘ä»¬ç”Ÿæˆçš„IPåœ°å€ï¼Œè·¯ç”±å™¨é‡Œé¢ä¼šè®°å½•æˆ‘ä»¬çš„MACåœ°å€ã€‚è€ŒMACåœ°å€æ˜¯å…¨çƒå”¯ä¸€çš„ã€‚ä¸¾ä¾‹ï¼ŒIPåœ°å€å°±å¦‚åŒæ˜¯æˆ‘ä»¬å±…ä½å°åŒºçš„åœ°å€ï¼Œè€ŒMACåœ°å€å°±æ˜¯æˆ‘ä»¬ä½çš„é‚£æ ‹æ¥¼é‚£ä¸ªæˆ¿é—´é‚£ä¸ªäººã€‚IPåœ°å€é‡‡ç”¨çš„IPv4æ ¼å¼ï¼Œç›®å‰æ­£åœ¨å‘IPv6è¿‡æ¸¡ã€‚

#### 1.5.2 TCPåè®®ï¼ˆTransmission Control Protocolï¼‰

ã€€ã€€TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯é¢å‘è¿æ¥çš„ä¼ è¾“å±‚åè®®ã€‚TCPå±‚æ˜¯ä½äºIPå±‚ä¹‹ä¸Šï¼Œåº”ç”¨å±‚ä¹‹ä¸‹çš„ä¸­é—´å±‚ã€‚ä¸åŒä¸»æœºçš„åº”ç”¨å±‚ä¹‹é—´ç»å¸¸éœ€è¦å¯é çš„ã€åƒç®¡é“ä¸€æ ·çš„è¿æ¥ï¼Œä½†æ˜¯IPå±‚ä¸æä¾›è¿™æ ·çš„æµæœºåˆ¶ï¼Œè€Œæ˜¯æä¾›ä¸å¯é çš„åŒ…äº¤æ¢ã€‚TCPåè®®é‡‡ç”¨å­—èŠ‚æµä¼ è¾“æ•°æ®ã€‚

#### 1.5.3 TCPçš„æŠ¥æ–‡æ ¼å¼

ã€€ã€€TCPæŠ¥æ–‡æ®µåŒ…æ‹¬åè®®é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ï¼Œåè®®é¦–éƒ¨çš„å›ºå®šéƒ¨åˆ†æ˜¯20ä¸ªå­—èŠ‚ï¼Œé¦–éƒ¨çš„å›ºå®šéƒ¨åˆ†åé¢æ˜¯é€‰é¡¹éƒ¨åˆ†ã€‚

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190504001611594-373661106.jpg)

ä¸‹é¢æ˜¯æŠ¥æ–‡æ®µé¦–éƒ¨å„ä¸ªå­—æ®µçš„å«ä¹‰ï¼š

1. **æºç«¯å£å·ä»¥åŠç›®çš„ç«¯å£å·**ï¼šå„å 2ä¸ªå­—èŠ‚ï¼Œç«¯å£æ˜¯ä¼ è¾“å±‚å’Œåº”ç”¨å±‚çš„æœåŠ¡æ¥å£ï¼Œç”¨äºå¯»æ‰¾å‘é€ç«¯å’Œæ¥æ”¶ç«¯çš„è¿›ç¨‹ï¼Œä¸€èˆ¬æ¥è®²ï¼Œé€šè¿‡ç«¯å£å·å’ŒIPåœ°å€ï¼Œå¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªTCPè¿æ¥ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œé€šå¸¸è¢«ç§°ä¸ºä¸€ä¸ªsocketæ¥å£ã€‚
2. **åºå·**ï¼šSeqåºå·ï¼Œå 4ä¸ªå­—èŠ‚ã€32ä½ã€‚ç”¨æ¥æ ‡è¯†ä»TCPå‘é€ç«¯å‘TCPæ¥æ”¶ç«¯å‘é€çš„æ•°æ®å­—èŠ‚æµã€‚å‘èµ·æ–¹å‘é€æ•°æ®æ—¶å¯¹æ­¤è¿›è¡Œæ ‡è®°ã€‚
3. **ç¡®è®¤åºå·**ï¼šAckåºå·ï¼Œå 4ä¸ªå­—èŠ‚ã€32ä½ã€‚åŒ…å«å‘é€ç¡®è®¤çš„ä¸€ç«¯æ‰€æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·ã€‚åªæœ‰ACKæ ‡è®°ä½ä¸º1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼Œå› æ­¤ï¼Œç¡®è®¤åºå·åº”è¯¥æ˜¯ä¸Šæ¬¡å·²ç»æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·åŠ 1ï¼Œå³Ack=Seq + 1ã€‚
4. **æ•°æ®åç§»**ï¼šå 4ä¸ªå­—èŠ‚ï¼Œç”¨äºæŒ‡å‡ºTCPé¦–éƒ¨é•¿åº¦ï¼Œè‹¥ä¸å­˜åœ¨é€‰é¡¹ï¼Œåˆ™è¿™ä¸ªå€¼ä¸º20å­—èŠ‚ï¼Œæ•°æ®åç§»çš„æœ€å¤§å€¼ä¸º60å­—èŠ‚ã€‚
5. **ä¿ç•™å­—æ®µ**å 6ä½ï¼Œæš‚æ—¶å¯å¿½ç•¥ï¼Œå€¼å…¨ä¸º0ã€‚
6. æ ‡å¿—ä½ï¼Œ6ä¸ª
   - URG(ç´§æ€¥)ï¼šä¸º1æ—¶è¡¨æ˜ç´§æ€¥æŒ‡é’ˆå­—æ®µæœ‰æ•ˆ
   - ACK(ç¡®è®¤)ï¼šä¸º1æ—¶è¡¨æ˜ç¡®è®¤å·å­—æ®µæœ‰æ•ˆ
   - PSH(æ¨é€)ï¼šä¸º1æ—¶æ¥æ”¶æ–¹åº”å°½å¿«å°†è¿™ä¸ªæŠ¥æ–‡æ®µäº¤ç»™åº”ç”¨å±‚
   - RST(å¤ä½)ï¼šä¸º1æ—¶è¡¨æ˜TCPè¿æ¥å‡ºç°æ•…éšœå¿…é¡»é‡å»ºè¿æ¥
   - SYN(åŒæ­¥)ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·
   - FIN(ç»ˆæ­¢)ï¼šä¸º1æ—¶è¡¨æ˜å‘é€ç«¯æ•°æ®å‘é€å®Œæ¯•è¦æ±‚é‡Šæ”¾è¿æ¥
7.  **æ¥æ”¶çª—å£ï¼š**å 2ä¸ªå­—èŠ‚ï¼Œç”¨äºæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œè¡¨ç¤ºå½“å‰æ¥æ”¶ç¼“å†²åŒºçš„å¤§å°ã€‚åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œé€šå¸¸æ˜¯ç”¨æ¥æ”¶æ–¹çš„æ¥æ”¶èƒ½åŠ›çš„å¤§å°æ¥æ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€é‡ã€‚TCPè¿æ¥çš„ä¸€ç«¯æ ¹æ®ç¼“å†²åŒºå¤§å°ç¡®å®šè‡ªå·±çš„æ¥æ”¶çª—å£å€¼ï¼Œå‘Šè¯‰å¯¹æ–¹ï¼Œä½¿å¯¹æ–¹å¯ä»¥ç¡®å®šå‘é€æ•°æ®çš„å­—èŠ‚æ•°ã€‚
8. **æ ¡éªŒå’Œï¼š**å 2ä¸ªå­—èŠ‚ï¼ŒèŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚
9. é€‰é¡¹æ˜¯å¯é€‰çš„ï¼Œé»˜è®¤æƒ…å†µæ˜¯ä¸é€‰ã€‚

### 1.6 TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹

â€‹		TCPæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œå› æ­¤æ¯ä¸ªTCPè¿æ¥éƒ½æœ‰3ä¸ªé˜¶æ®µï¼šè¿æ¥å»ºç«‹ã€æ•°æ®ä¼ é€å’Œè¿æ¥é‡Šæ”¾ã€‚è¿æ¥å»ºç«‹ç»å†ä¸‰ä¸ªæ­¥éª¤ï¼Œé€šå¸¸ç§°ä¸ºâ€œä¸‰æ¬¡æ¡æ‰‹â€ã€‚

ã€€**TCPä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹**å¦‚ä¸‹ï¼š

ã€€ã€€![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190503210424740-1764008697.jpg)

1. ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼‰

ã€€ã€€  å®¢æˆ·æœºå‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µåˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ã€‚å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µå†…å®¹ï¼šSYN=1ï¼Œseq=xï¼›SYN=1æ„æ€æ˜¯ä¸€ä¸ªTCPçš„SYNæ ‡å¿—ä½ç½®ä¸º1çš„åŒ…ï¼ŒæŒ‡æ˜å®¢æˆ·ç«¯æ‰“ç®—è¿æ¥çš„æœåŠ¡å™¨çš„ç«¯å£ï¼›seq=xè¡¨ç¤ºå®¢æˆ·ç«¯åˆå§‹åºå·xï¼Œä¿å­˜åœ¨åŒ…å¤´çš„åºåˆ—å·ï¼ˆSequence Numberï¼‰å­—æ®µé‡Œã€‚

2. ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ˆæœåŠ¡ç«¯å›ä¼ ç¡®è®¤ï¼‰

ã€€ã€€  æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œå‘å®¢æˆ·æœºå‘å›ç¡®è®¤æŠ¥æ–‡æ®µï¼ˆACKï¼‰åº”ç­”ï¼Œå¹¶ä¸ºè¯¥TCPè¿æ¥åˆ†é…TCPç¼“å­˜å’Œå˜é‡ã€‚æœåŠ¡å™¨å‘å›ç¡®è®¤æŠ¥æ–‡æ®µå†…å®¹ï¼šSYN=1ï¼ŒACK=1ï¼Œseq=yï¼Œack=x+1ï¼›SYNæ ‡å¿—ä½å’ŒACKæ ‡å¿—ä½å‡ä¸º1ï¼ŒåŒæ—¶å°†ç¡®è®¤åºå·ï¼ˆAcknowledgement Numberï¼‰è®¾ç½®ä¸ºå®¢æˆ·çš„ISNåŠ 1ï¼Œå³x+1ï¼›seq=yä¸ºæœåŠ¡ç«¯åˆå§‹åºå·yã€‚

3. ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼ˆå®¢æˆ·ç«¯å›ä¼ ç¡®è®¤ï¼‰

ã€€ã€€  å®¢æˆ·æœºæ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤æŠ¥æ–‡æ®µåï¼Œå‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤æŠ¥æ–‡æ®µï¼ˆACKï¼‰ï¼Œå¹¶ä¸”ä¹Ÿè¦ç»™è¯¥è¿æ¥åˆ†é…ç¼“å­˜å’Œå˜é‡ã€‚æ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥ESTABLISHEDï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹ã€‚å®¢æˆ·ç«¯å‘å›ç¡®è®¤æŠ¥æ–‡æ®µå†…å®¹ï¼šACK=1ï¼Œseq=x+1ï¼Œack=y+1ï¼›ACK=1ä¸ºç¡®è®¤æŠ¥æ–‡æ®µï¼›seq=x+1ä¸ºå®¢æˆ·ç«¯åºå·åŠ 1ï¼›ack=y+1,ä¸ºæœåŠ¡å™¨å‘æ¥çš„ACKçš„åˆå§‹åºå·å­—æ®µ+1ã€‚

ã€€ã€€æ³¨æ„ï¼šæ¡æ‰‹è¿‡ç¨‹ä¸­ä¼ é€çš„åŒ…é‡Œä¸åŒ…å«æ•°æ®ï¼Œä¸‰æ¬¡æ¡æ‰‹å®Œæ¯•åï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ‰æ­£å¼å¼€å§‹ä¼ é€æ•°æ®ã€‚



ã€€**TCPå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹**å¦‚ä¸‹ï¼š

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190503231436105-1355677452.png)

ã€€ç”±äºTCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤æ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»å•ç‹¬è¿›è¡Œå…³é—­ã€‚è¿™åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆå®ƒçš„æ•°æ®å‘é€ä»»åŠ¡åå°±èƒ½å‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸ªæ–¹å‘çš„è¿æ¥ã€‚æ”¶åˆ°ä¸€ä¸ªFINåªæ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨ï¼Œä¸€ä¸ªTCPè¿æ¥åœ¨æ”¶åˆ°ä¸€ä¸ªFINåä»èƒ½å‘é€æ•°æ®ã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹æ‰§è¡Œè¢«åŠ¨å…³é—­ã€‚

1. TCPå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®ä¼ é€ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚å‘é€æŠ¥æ–‡æ®µå†…å®¹ï¼šFIN=1ï¼Œseq=uï¼›FIN=1è¡¨ç¤ºè¯·æ±‚åˆ‡æ–­è¿æ¥ï¼›seq=uä¸ºå®¢æˆ·ç«¯è¯·æ±‚åˆå§‹åºå·ã€‚

2. æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªFINï¼Œå®ƒå‘å›ä¸€ä¸ªACKç»™å®¢æˆ·ç«¯ï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1ã€‚å’ŒSYNä¸€æ ·ï¼Œä¸€ä¸ªFINå°†å ç”¨ä¸€ä¸ªåºå·ï¼›æœåŠ¡ç«¯è¿›å…¥CLOSE_WAITçŠ¶æ€ã€‚å‘é€æŠ¥æ–‡æ®µå†…å®¹ï¼šACK=1ï¼Œseq=vï¼Œack=u+1ï¼›ACK=1ä¸ºç¡®è®¤æŠ¥æ–‡ï¼›seq=vä¸ºæœåŠ¡å™¨ç¡®è®¤åˆå§‹åºå·ï¼›ack=u+1ä¸ºå®¢æˆ·ç«¯åˆå§‹åºå·åŠ 1ã€‚

3. æœåŠ¡å™¨å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥åï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯è¿›å…¥LAST_ACKçŠ¶æ€ã€‚å‘é€æŠ¥æ–‡æ®µå†…å®¹ï¼šFIN=1ï¼ŒACK=1ï¼Œseq=wï¼Œack=u+1ï¼›FIN=1ä¸ºè¯·æ±‚åˆ‡æ–­è¿æ¥ï¼ŒACK=1ä¸ºç¡®è®¤æŠ¥æ–‡ï¼Œseq=wä¸ºæœåŠ¡ç«¯è¯·æ±‚åˆ‡æ–­åˆå§‹åºå·ã€‚

4. å®¢æˆ·ç«¯æ”¶åˆ°FINåï¼Œå®¢æˆ·ç«¯è¿›å…¥TIME_WAITçŠ¶æ€ï¼Œæ¥ç€å‘å›ä¸€ä¸ªACKæŠ¥æ–‡ç»™æœåŠ¡ç«¯ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1ï¼ŒæœåŠ¡ç«¯è¿›å…¥CLOSEDçŠ¶æ€ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚å‘é€æŠ¥æ–‡å†…å®¹ï¼šACK=1ï¼Œseq=u+1ï¼Œack=w+1ï¼›ACK=1ä¸ºç¡®è®¤æŠ¥æ–‡ï¼Œseq=u+1ä¸ºå®¢æˆ·ç«¯åˆå§‹åºå·åŠ 1ï¼Œack=w+1ä¸ºæœåŠ¡å™¨åˆå§‹åºå·åŠ 1ã€‚

   

> æ³¨æ„ï¼šä¸ºä»€ä¹ˆè¿æ¥çš„æ—¶å€™æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­çš„æ—¶å€™å´æ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ
>
> ã€€ã€€ã€€å› ä¸ºå½“æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNè¿æ¥è¯·æ±‚æŠ¥æ–‡åï¼Œå¯ä»¥ç›´æ¥å‘é€SYN+ACKæŠ¥æ–‡ã€‚å…¶ä¸­ACKæŠ¥æ–‡æ˜¯ç”¨æ¥åº”ç­”çš„ï¼ŒSYNæŠ¥æ–‡æ˜¯ç”¨æ¥åŒæ­¥çš„ã€‚ä½†æ˜¯å…³é—­è¿æ¥æ—¶ï¼Œå½“æœåŠ¡ç«¯æ”¶åˆ°FINæŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½å¹¶ä¸ä¼šç«‹å³å…³é—­socketï¼Œæ‰€ä»¥åªèƒ½å…ˆå›å¤ä¸€ä¸ªACKæŠ¥æ–‡ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œâ€œä½ å‘çš„FINæŠ¥æ–‡ï¼Œæˆ‘æ”¶åˆ°äº†â€ã€‚åªæœ‰ç­‰åˆ°æœåŠ¡ç«¯æ‰€æœ‰çš„æŠ¥æ–‡éƒ½å‘é€å®Œäº†ï¼Œæˆ‘æ‰èƒ½å‘é€FINæŠ¥æ–‡ï¼Œå› æ­¤ä¸èƒ½ä¸€èµ·å‘é€ï¼Œæ•…éœ€è¦å››æ­¥æŒ¥æ‰‹ã€‚

### 1.7 UDPåè®®ï¼ˆUser Datagram Protocolï¼‰

ã€€UDPï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œå®ƒæ˜¯TCP/IPåè®®ç°‡ä¸­æ— è¿æ¥çš„è¿è¾“å±‚åè®®ã€‚

1. UDPæ˜¯ä¸€ä¸ªéè¿æ¥çš„åè®®ï¼Œä¼ è¾“æ•°æ®ä¹‹å‰æºç«¯å’Œç»ˆç«¯ä¸å»ºç«‹è¿æ¥ï¼Œå½“å®ƒæƒ³ä¼ é€æ—¶å°±ç®€å•åœ°å»æŠ“å–æ¥è‡ªåº”ç”¨ç¨‹åºçš„æ•°æ®ï¼Œå¹¶å°½å¯èƒ½å¿«åœ°æŠŠå®ƒæ‰”åˆ°ç½‘ç»œä¸Šã€‚åœ¨å‘é€ç«¯ï¼ŒUDPä¼ é€æ•°æ®çš„é€Ÿåº¦ä»…ä»…æ˜¯å—åº”ç”¨ç¨‹åºç”Ÿæˆæ•°æ®çš„é€Ÿåº¦ã€è®¡ç®—æœºçš„èƒ½åŠ›å’Œä¼ è¾“å¸¦å®½çš„é™åˆ¶ï¼›åœ¨æ¥æ”¶ç«¯ï¼ŒUDPæŠŠæ¯ä¸ªæ¶ˆæ¯æ®µæ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œåº”ç”¨ç¨‹åºæ¯æ¬¡ä»é˜Ÿåˆ—ä¸­è¯»ä¸€ä¸ªæ¶ˆæ¯æ®µã€‚
2. ç”±äºä¼ è¾“æ•°æ®ä¸å»ºç«‹è¿æ¥ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼ŒåŒ…æ‹¬æ”¶å‘çŠ¶æ€ç­‰ï¼Œå› æ­¤ä¸€å°æœåŠ¡å™¨å¯åŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯ä¼ è¾“ç›¸åŒçš„æ¶ˆæ¯ã€‚
3. UDPä¿¡æ¯åŒ…çš„æ ‡é¢˜å¾ˆçŸ­ï¼Œåªæœ‰8ä¸ªå­—èŠ‚ï¼Œç›¸å¯¹äºTCPçš„20ä¸ªå­—èŠ‚ä¿¡æ¯åŒ…çš„é¢å¤–å¼€é”€å¾ˆå°ã€‚
4. ååé‡ä¸å—æ‹¥æŒ¤æ§åˆ¶ç®—æ³•çš„è°ƒèŠ‚ï¼Œåªå—åº”ç”¨è½¯ä»¶ç”Ÿæˆæ•°æ®çš„é€Ÿç‡ã€ä¼ è¾“å¸¦å®½ã€æºç«¯å’Œç»ˆç«¯ä¸»æœºæ€§èƒ½çš„é™åˆ¶ã€‚
5. UDPä½¿ç”¨å°½é‡æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œå³ä¸ä¿è¯å¯é äº¤ä»˜ï¼Œå› æ­¤ä¸»æœºä¸éœ€è¦ç»´æŒå¤æ‚çš„é“¾æ¥çŠ¶æ€è¡¨ã€‚
6. UDPæ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨å—å°±å‘ä¸‹äº¤ä»˜ç»™IPå±‚ã€‚æ—¢ä¸æ‹†åˆ†ï¼Œä¹Ÿä¸åˆå¹¶ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œï¼Œå› æ­¤ï¼Œåº”ç”¨ç¨‹åºéœ€è¦é€‰æ‹©åˆé€‚çš„æŠ¥æ–‡å¤§å°ã€‚

**UDPåè®®æ ¼å¼**

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190504154900038-1234898266.png)

ã€€UDPåè®®ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šé¦–éƒ¨å’Œæ•°æ®ã€‚å…¶ä¸­ï¼Œé¦–éƒ¨ä»…æœ‰8ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬æºç«¯å£å’Œç›®çš„ç«¯å£ã€é•¿åº¦ï¼ˆUDPç”¨äºæ•°æ®æŠ¥çš„é•¿åº¦ï¼‰ã€æ ¡éªŒå’Œã€‚

### 1.8 TCPä¸UDPçš„åŒºåˆ«

1. TCPåŸºäºè¿æ¥ï¼ŒUDPæ˜¯æ— è¿æ¥çš„ï¼›
2. å¯¹ç³»ç»Ÿèµ„æºçš„è¦æ±‚ï¼ŒTCPè¾ƒå¤šï¼ŒUDPè¾ƒå°‘ï¼›
3. UDPç¨‹åºç»“æ„è¾ƒç®€å•ï¼›
4. TCPæ˜¯æµæ¨¡å¼ï¼Œè€ŒUDPæ˜¯æ•°æ®æŠ¥æ¨¡å¼ï¼›
5. TCPä¿è¯æ•°æ®æ­£ç¡®æ€§ï¼Œè€ŒUDPå¯èƒ½ä¸¢åŒ…ï¼›TCPä¿è¯æ•°æ®é¡ºåºï¼Œè€ŒUDPä¸ä¿è¯ï¼›

### 1.9 HTTPåè®®ï¼ˆHypertext Transfer Protocolï¼‰

HTTPï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œå®ƒæ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚HTTPæ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œå®ƒæ˜¯åŸºäºTCPåè®®ä¹‹ä¸Šçš„è¯·æ±‚/å“åº”å¼çš„åè®®ã€‚HTTPåè®®æ˜¯Webæµè§ˆå™¨å’ŒWebæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„æ ‡å‡†åè®®ã€‚HTTPæŒ‡å®šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¦‚ä½•å»ºç«‹è¿æ¥ã€å®¢æˆ·ç«¯å¦‚ä½•ä»æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡å™¨å¦‚ä½•å“åº”è¯·æ±‚ï¼Œä»¥åŠæœ€åå¦‚ä½•å…³é—­è¿æ¥ã€‚HTTPè¿æ¥ä½¿ç”¨TCP/IPæ¥ä¼ è¾“æ•°æ®ã€‚

ã€€ã€€å¯¹äºä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ¯ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½æœ‰4ä¸ªæ­¥éª¤ï¼š

1. é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯åœ¨ç«¯å£80æ‰“å¼€ä¸æœåŠ¡å™¨çš„ä¸€ä¸ªTCPè¿æ¥ï¼ŒURLä¸­è¿˜å¯ä»¥æŒ‡å®šå…¶ä»–ç«¯å£ã€‚
2. å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œè¯·æ±‚æŒ‡å®šè·¯å¾„ä¸Šçš„èµ„æºã€‚è¿™ä¸ªèµ„æºåŒ…æ‹¬ä¸€ä¸ªé¦–éƒ¨ï¼Œå¯é€‰åœ°ï¼ˆå–å†³äºè¯·æ±‚çš„æ€§è´¨ï¼‰è¿˜å¯ä»¥æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œåé¢æ˜¯è¿™ä¸ªè¯·æ±‚çš„æ•°æ®ã€‚
3. æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚å“åº”ä»¥å“åº”ç å¼€å¤´ï¼Œåé¢æ˜¯åŒ…å«æ•°æ®çš„é¦–éƒ¨ã€ä¸€ä¸ªç©ºè¡Œä»¥åŠæ‰€è¯·æ±‚çš„æ–‡æ¡£æˆ–é”™è¯¯æ¶ˆæ¯ã€‚
4. æœåŠ¡å™¨å…³é—­è¿æ¥ã€‚

ã€€ã€€ç°åœ¨ä½¿ç”¨çš„HTTPåè®®æ˜¯HTTP/1.1ç‰ˆæœ¬ï¼Œ1997å¹´ä¹‹å‰é‡‡ç”¨çš„æ˜¯HTTP1.0ç‰ˆæœ¬ã€‚HTTPè¿æ¥åœ¨1.0ç‰ˆæœ¬ä¸­é‡‡ç”¨éæŒç»­è¿æ¥å·¥ä½œæ–¹å¼ï¼Œ1.1ç‰ˆæœ¬é‡‡ç”¨çš„æ˜¯æŒç»­è¿æ¥å·¥ä½œæ–¹å¼ï¼ŒæŒç»­è¿æ¥æ˜¯æŒ‡æœåŠ¡å™¨åœ¨å‘é€å“åº”åä»ç„¶åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒè¿™æ¡ç”±TCPè¿è¾“å±‚åè®®å»ºç«‹èµ·æ¥çš„è¿æ¥ï¼Œä½¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ç»§ç»­åœ¨è¿™æ¡è¿æ¥ä¸Šä¼ è¾“HTTPæŠ¥æ–‡ã€‚

ã€€ã€€æ˜¯å¦é‡‡ç”¨æŒç»­è¿æ¥å·¥ä½œæ–¹å¼ï¼Œ1.0ä¸­é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦åœ¨HTTPå¤´åŠ å…¥â€œConnection:Keep-Aliveâ€ï¼Œæ‰èƒ½å¯ç”¨Keep-Aliveã€‚HTTP1.1ä¸­é»˜è®¤å¯ç”¨Keep-Aliveï¼Œå¦‚æœåŠ å…¥â€œConnection:closeâ€ï¼Œæ‰å…³é—­ã€‚ç›®å‰å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ˜¯ç”¨HTTP1.1åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤éƒ½ä¼šå‘èµ·Keep-Aliveçš„è¿æ¥è¯·æ±‚äº†ï¼Œæ‰€ä»¥æ˜¯å¦èƒ½å®Œæˆä¸€ä¸ªå®Œæ•´çš„Keep-Aliveè¿æ¥å°±çœ‹æœåŠ¡å™¨è®¾ç½®æƒ…å†µã€‚

### 1.10 HTTPå’ŒHTTPSçš„åŒºåˆ«

HTTPSï¼ˆå…¨ç§°ï¼šHyper Text Transfer Protocol over Secure Socket Layerï¼‰ï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„HTTPé€šé“ï¼Œç®€å•æ¥è¯´å°±æ˜¯HTTPçš„å®‰å…¨ç‰ˆã€‚å³HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦SSLã€‚å®ƒæ˜¯ä¸€ä¸ªURL schemeï¼ˆæŠ½è±¡æ ‡è¯†ç¬¦ä½“ç³»ï¼‰ï¼Œå¥æ³•ç±»åŒhttp:ä½“ç³»ï¼Œç”¨äºå®‰å…¨çš„HTTPæ•°æ®ä¼ è¾“ã€‚https:URLè¡¨æ˜å®ƒä½¿ç”¨äº†HTTPï¼Œä½†HTTPSå­˜åœ¨ä¸åŒäºHTTPçš„é»˜è®¤ç«¯å£åŠä¸€ä¸ªåŠ å¯†/èº«ä»½éªŒè¯å±‚ï¼ˆåœ¨HTTPä¸TCPä¹‹é—´ï¼‰ã€‚

ã€€ã€€è¶…æ–‡æœ¬ä¼ è¾“åè®®HTTPåè®®è¢«ç”¨äºåœ¨Webæµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚HTTPåè®®ä»¥æ˜æ–‡æ–¹å¼å‘é€å†…å®¹ï¼Œä¸æä¾›ä»»ä½•æ–¹å¼çš„æ•°æ®åŠ å¯†ï¼Œå¦‚æœæ”»å‡»è€…æˆªå–äº†Webæµè§ˆå™¨å’Œç½‘ç«™æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“æŠ¥æ–‡ï¼Œå°±å¯ä»¥ç›´æ¥è¯»æ‡‚å…¶ä¸­çš„ä¿¡æ¯ï¼Œå› æ­¤HTTPåè®®ä¸é€‚åˆä¼ è¾“ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚ä¿¡ç”¨å¼€å·ã€å¯†ç ç­‰ã€‚

ã€€ã€€ä¸ºäº†è§£å†³HTTPåè®®çš„è¿™ä¸€ç¼ºé™·ï¼Œéœ€è¦ä½¿ç”¨å¦ä¸€ç§åè®®ï¼šå®‰å…¨å¥—æ¥å­—å±‚è¶…æ–‡æœ¬ä¼ è¾“åè®®HTTPSã€‚ä¸ºäº†æ•°æ®ä¼ è¾“çš„å®‰å…¨ï¼ŒHTTPSåœ¨HTTPçš„åŸºç¡€ä¸ŠåŠ å…¥äº†SSLåè®®ï¼ŒSSLä¾é è¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åŠ å¯†ã€‚

ã€€ã€€HTTPSå’ŒHTTPçš„åŒºåˆ«ä¸»è¦ä¸ºä»¥ä¸‹å››ç‚¹ï¼š

- httpsåè®®éœ€è¦åˆ°caç”³è¯·è¯ä¹¦ï¼Œä¸€èˆ¬å…è´¹è¯ä¹¦å¾ˆå°‘ï¼Œéœ€è¦ç¼´è´¹ã€‚
- httpæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä¿¡æ¯æ˜¯æ˜æ–‡ä¼ è¾“ï¼Œhttpsåˆ™æ˜¯å…·æœ‰å®‰å…¨æ€§çš„sslåŠ å¯†ä¼ è¾“åè®®ã€‚
- httpå’Œhttpsä½¿ç”¨çš„æ˜¯å®Œå…¨ä¸åŒçš„è¿æ¥æ–¹å¼ï¼Œç”¨çš„ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯80ï¼Œåè€…æ˜¯443ã€‚
- httpçš„è¿æ¥å¾ˆç®€å•ï¼Œæ˜¯æ— çŠ¶æ€çš„ï¼›httpsåè®®æ˜¯æœ‰ssl+httpåè®®æ„å»ºçš„å¯è¿›è¡ŒåŠ å¯†ä¼ è¾“ã€èº«ä»½è®¤è¯çš„ç½‘ç»œåè®®ï¼Œæ¯”httpåè®®å®‰å…¨ã€‚

### 1.11 HTTPå’ŒTCP/IPåè®®çš„å…³ç³»

ç½‘ç»œä¸­æœ‰ä¸€æ®µæ¯”è¾ƒå®¹æ˜“ç†è§£çš„ä»‹ç»ï¼š

ã€€ã€€â€œæˆ‘ä»¬åœ¨ä¼ è¾“æ•°æ®æ—¶ï¼Œå¯ä»¥åªä½¿ç”¨ï¼ˆä¼ è¾“å±‚ï¼‰TCP/IPåè®®ï¼Œä½†æ˜¯é‚£æ ·çš„è¯ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨å±‚ï¼Œä¾¿æ— æ³•è¯†åˆ«æ•°æ®å†…å®¹ï¼Œå¦‚æœæƒ³è¦ä½¿ä¼ è¾“çš„æ•°æ®æœ‰æ„ä¹‰ï¼Œåˆ™å¿…é¡»ä½¿ç”¨åˆ°åº”ç”¨å±‚åè®®ï¼Œåº”ç”¨å±‚åè®®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚HTTPã€FTPã€TELNETç­‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰åº”ç”¨å±‚åè®®ã€‚WEBä½¿ç”¨HTTPåè®®ä½œåº”ç”¨å±‚åè®®ï¼Œä»¥å°è£…HTTPæ–‡æœ¬ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨TCP/IPåšä¼ è¾“å±‚åè®®å°†å®ƒå‘åˆ°ç½‘ç»œä¸Šã€‚â€

## 2. Java ç½‘ç»œç¼–ç¨‹

### 2.1 Socketæ¦‚è¿°

â€‹	Javaçš„ç½‘ç»œç¼–ç¨‹ä¸»è¦æ¶‰åŠåˆ°çš„å†…å®¹æ˜¯Socketç¼–ç¨‹ã€‚Socketï¼Œå¥—æ¥å­—ï¼Œå°±æ˜¯ä¸¤å°ä¸»æœºä¹‹é—´é€»è¾‘è¿æ¥çš„ç«¯ç‚¹ã€‚TCP/IPåè®®æ˜¯ä¼ è¾“å±‚åè®®ï¼Œä¸»è¦è§£å†³æ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œè€ŒHTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œä¸»è¦è§£å†³å¦‚ä½•åŒ…è£…æ•°æ®ã€‚Socketæ˜¯é€šä¿¡çš„åŸºçŸ³ï¼Œæ˜¯æ”¯æŒTCP/IPåè®®çš„ç½‘ç»œé€šä¿¡çš„åŸºæœ¬æ“ä½œå•å…ƒã€‚å®ƒæ˜¯ç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­ç«¯ç‚¹çš„æŠ½è±¡è¡¨ç¤ºï¼ŒåŒ…å«è¿›è¡Œç½‘ç»œé€šä¿¡å¿…é¡»çš„äº”ç§ä¿¡æ¯ï¼šè¿æ¥ä½¿ç”¨çš„åè®®ã€æœ¬åœ°ä¸»æœºçš„IPåœ°å€ã€æœ¬åœ°è¿›ç¨‹çš„åè®®ç«¯å£ã€è¿œç¨‹ä¸»æœºçš„IPåœ°å€ã€è¿œç¨‹è¿›ç¨‹çš„åè®®ç«¯å£ã€‚

ã€€ã€€åº”ç”¨å±‚é€šè¿‡ä¼ è¾“å±‚è¿›è¡Œæ•°æ®é€šä¿¡æ—¶ï¼ŒTCPä¼šé‡åˆ°åŒæ—¶ä¸ºå¤šä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹æä¾›å¹¶å‘æœåŠ¡çš„é—®é¢˜ã€‚å¤šä¸ªTCPè¿æ¥æˆ–å¤šä¸ªåº”ç”¨ç¨‹åºè¿›ç¨‹å¯èƒ½éœ€è¦é€šè¿‡åŒä¸€ä¸ªTCPåè®®ç«¯å£ä¼ è¾“æ•°æ®ã€‚ä¸ºäº†åŒºåˆ«ä¸åŒçš„åº”ç”¨ç¨‹åºè¿›ç¨‹å’Œè¿æ¥ï¼Œè®¸å¤šè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸ºåº”ç”¨ç¨‹åºä¸TCP/IPåè®®äº¤äº’æä¾›äº†å¥—æ¥å­—ï¼ˆSocketï¼‰æ¥å£ã€‚åº”ç”¨å±‚å¯ä»¥å’Œä¼ è¾“å±‚é€šè¿‡Socketæ¥å£ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒåº”ç”¨ç¨‹åºè¿›ç¨‹æˆ–ç½‘ç»œè¿æ¥çš„é€šä¿¡ï¼Œå®ç°æ•°æ®ä¼ è¾“çš„å¹¶å‘æœåŠ¡ã€‚

ã€€ã€€Socketï¼Œå®é™…ä¸Šæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼ŒSocketæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£ï¼ˆAPIï¼‰ï¼Œé€šè¿‡Socketï¼Œæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨TCP/IPåè®®ã€‚å®é™…ä¸Šï¼ŒSocketè·ŸTCP/IPåè®®æ²¡æœ‰å¿…ç„¶çš„å…³ç³»ï¼ŒSocketç¼–ç¨‹æ¥å£åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œå°±å¸Œæœ›ä¹Ÿèƒ½é€‚åº”å…¶ä»–çš„ç½‘ç»œåè®®ã€‚æ‰€ä»¥è¯´ï¼ŒSocketçš„å‡ºç°ï¼Œåªæ˜¯ä½¿å¾—ç¨‹åºå‘˜æ›´æ–¹ä¾¿åœ°ä½¿ç”¨TCP/IPåè®®æ ˆè€Œå·²ï¼Œæ˜¯å¯¹TCP/IPåè®®çš„æŠ½è±¡ï¼Œä»è€Œå½¢æˆäº†æˆ‘ä»¬çŸ¥é“çš„ä¸€äº›æœ€åŸºæœ¬çš„å‡½æ•°æ¥å£ï¼Œæ¯”å¦‚createã€listenã€acceptã€sendã€readå’Œwriteç­‰ç­‰ã€‚ç½‘ç»œæœ‰ä¸€æ®µå…³äºsocketå’ŒTCP/IPåè®®å…³ç³»çš„è¯´æ³•æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼š

ã€€ã€€â€œTCP/IPåªæ˜¯ä¸€ä¸ªåè®®æ ˆï¼Œå°±åƒæ“ä½œç³»ç»Ÿçš„è¿è¡Œæœºåˆ¶ä¸€æ ·ï¼Œå¿…é¡»è¦å…·ä½“å®ç°ï¼ŒåŒæ—¶è¿˜è¦æä¾›å¯¹å¤–çš„æ“ä½œæ¥å£ã€‚è¿™ä¸ªå°±åƒæ“ä½œç³»ç»Ÿä¼šæä¾›æ ‡å‡†çš„ç¼–ç¨‹æ¥å£ï¼Œæ¯”å¦‚win32ç¼–ç¨‹æ¥å£ä¸€æ ·ï¼ŒTCP/IPä¹Ÿè¦æä¾›å¯ä¾›ç¨‹åºå‘˜åšç½‘ç»œå¼€å‘æ‰€ç”¨çš„æ¥å£ï¼Œè¿™å°±æ˜¯Socketç¼–ç¨‹æ¥å£ã€‚â€ 

 ã€€å®é™…ä¸Šï¼Œä¼ è¾“å±‚çš„TCPæ˜¯åŸºäºç½‘ç»œå±‚çš„IPåè®®çš„ï¼Œè€Œåº”ç”¨å±‚çš„HTTPåè®®åˆæ˜¯åŸºäºä¼ è¾“å±‚çš„TCPåè®®çš„ï¼Œè€ŒSocketæœ¬èº«ä¸ç®—æ˜¯åè®®ï¼Œå°±åƒä¸Šé¢æ‰€è¯´ï¼Œå®ƒåªæ˜¯æä¾›äº†ä¸€ä¸ªé’ˆå¯¹TCPæˆ–è€…UDPç¼–ç¨‹çš„æ¥å£ã€‚socketæ˜¯å¯¹ç«¯å£é€šä¿¡å¼€å‘çš„å·¥å…·,å®ƒè¦æ›´åº•å±‚ä¸€äº›ã€‚

### 2.2 Socket æ•´ä½“æµç¨‹

â€‹	Socketç¼–ç¨‹ä¸»è¦æ¶‰åŠåˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤ä¸ªæ–¹é¢ï¼Œé¦–å…ˆæ˜¯åœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å¥—æ¥å­—ï¼ˆServerSocketï¼‰ï¼Œå¹¶æŠŠå®ƒé™„åŠ åˆ°ä¸€ä¸ªç«¯å£ä¸Šï¼ŒæœåŠ¡å™¨ä»è¿™ä¸ªç«¯å£ç›‘å¬è¿æ¥ã€‚ç«¯å£å·çš„èŒƒå›´æ˜¯0åˆ°65536ï¼Œä½†æ˜¯0åˆ°1024æ˜¯ä¸ºç‰¹æƒæœåŠ¡ä¿ç•™çš„ç«¯å£å·ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªå½“å‰æ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨çš„ç«¯å£ã€‚

ã€€ã€€å®¢æˆ·ç«¯è¯·æ±‚ä¸æœåŠ¡å™¨è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œæ ¹æ®æœåŠ¡å™¨çš„åŸŸåæˆ–è€…IPåœ°å€ï¼ŒåŠ ä¸Šç«¯å£å·ï¼Œæ‰“å¼€ä¸€ä¸ªå¥—æ¥å­—ã€‚å½“æœåŠ¡å™¨æ¥å—è¿æ¥åï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡å°±åƒè¾“å…¥è¾“å‡ºæµä¸€æ ·è¿›è¡Œæ“ä½œã€‚

![img](https://gitee.com/Kunaly/picture-bed/raw/master/img/1217276-20190505145914692-1580218673.png)

### 2.3 InetAddress ç±»

```java
package com.kun.api;

import java.net.InetAddress;
import java.net.UnknownHostException;

/**
 * InetAddressçš„ä½¿ç”¨
 */
public class InetAddressDemo {
    public static void main(String[] args) throws UnknownHostException {
        //è·å–æœ¬æœºçš„InetAddresså¯¹è±¡
        InetAddress localHost = InetAddress.getLocalHost();
        System.out.println(localHost);

        //æ ¹æ®æŒ‡å®šä¸»æœºå è·å–InetAddresså¯¹è±¡
        InetAddress localHost1 = InetAddress.getByName("LAPTOP-PRHA00NF");
        System.out.println(localHost1);

        //æ ¹æ®åŸŸåè¿”å›
        InetAddress host = InetAddress.getByName("www.baidu.com");
        System.out.println(host);
        String hostAddress = host.getHostAddress();

        System.out.println("hostå¯¹åº”çš„ipï¼š"+hostAddress+"ï¼Œä¸»æœºåï¼š"+host.getHostName());
    }
}
```

### 2.4 TCP é€šä¿¡ä¾‹å­

#### demo1ï¼šå•å‘é€šä¿¡

```java
package com.kun.socket;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class TcpServer01 {

    public static void main(String[] args) throws IOException {
        //1.åœ¨æœ¬æœºçš„9999ç«¯å£ç›‘å¬ï¼Œç­‰å¾…è¿æ¥
        ServerSocket serverSocket = new ServerSocket(9999);
        System.out.println("æœåŠ¡ç«¯ï¼Œåœ¨9999ç«¯å£ç›‘å¬ï¼Œç­‰å¾…è¿æ¥ã€‚ã€‚ã€‚");
        //2.å½“æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥9999ç«¯å£æ—¶ï¼Œç¨‹åºé˜»å¡ï¼Œç­‰å¾…è¿æ¥
        //  å¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›Socketå¯¹è±¡ï¼Œç¨‹åºç»§ç»­
        Socket socket = serverSocket.accept();
        System.out.println("socket = "+ socket.getClass());
        
        //3.é€šè¿‡socket.getInputStream()è¯»å–å®¢æˆ·ç«¯å†™å…¥åˆ°æ•°æ®é€šé“çš„æ•°æ®
        InputStream inputStream = socket.getInputStream();
        //4.IOè¯»å–
        byte[] buf = new byte[1024];
        int readLen = 0;
        while ((readLen = inputStream.read(buf)) != -1){
            System.out.println(new String(buf,0,readLen));
        }

        //5.å…³é—­æµå¯¹è±¡å’Œsocket
        inputStream.close();
        socket.close();
        serverSocket.close();
    }
}
```

```java
package com.kun.socket;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.InetAddress;
import java.net.Socket;
import java.net.UnknownHostException;

public class TcpClient01 {
    public static void main(String[] args) throws IOException {
        //1.è¿æ¥æœåŠ¡å™¨ï¼ˆip + ç«¯å£ï¼‰
        Socket socket = new Socket(InetAddress.getLocalHost(), 9999);
        System.out.println("å®¢æˆ·ç«¯ socketè¿”å›ï¼š"+socket.getClass());
        //2.è¿æ¥æˆåŠŸï¼Œç”Ÿæˆsocket,é€šè¿‡socket.getOutputStream()å¾—åˆ°å’Œsocketç›¸å…³è”çš„è¾“å‡ºæµå¯¹è±¡
        OutputStream outputStream = socket.getOutputStream();
        //3.é€šè¿‡è¾“å‡ºæµï¼Œå†™å…¥æ•°æ®åˆ°æ•°æ®é€šé“
        outputStream.write("hello server".getBytes());
        //è®¾ç½®ç»“æŸæ ‡è®°
        socket.shutdownOutput();
        //4.å…³é—­æµå¯¹è±¡å’Œsocket
        outputStream.close();
        socket.close();
        System.out.println("å®¢æˆ·ç«¯é€€å‡ºã€‚");
    }
}
```

#### demo2ï¼šåŒå‘é€šä¿¡

```java
package com.kun.socket;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class TcpServer02 {

    public static void main(String[] args) throws IOException {
        //1.åœ¨æœ¬æœºçš„9999ç«¯å£ç›‘å¬ï¼Œç­‰å¾…è¿æ¥
        ServerSocket serverSocket = new ServerSocket(9999);
        System.out.println("æœåŠ¡ç«¯ï¼Œåœ¨9999ç«¯å£ç›‘å¬ï¼Œç­‰å¾…è¿æ¥ã€‚ã€‚ã€‚");
        //2.å½“æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥9999ç«¯å£æ—¶ï¼Œç¨‹åºé˜»å¡ï¼Œç­‰å¾…è¿æ¥
        //  å¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›Socketå¯¹è±¡ï¼Œç¨‹åºç»§ç»­
        Socket socket = serverSocket.accept();
        System.out.println("socket = "+ socket.getClass());
        
        //3.é€šè¿‡socket.getInputStream()è¯»å–å®¢æˆ·ç«¯å†™å…¥åˆ°æ•°æ®é€šé“çš„æ•°æ®
        InputStream inputStream = socket.getInputStream();
        //4.IOè¯»å–
        byte[] buf = new byte[1024];
        int readLen = 0;
        while ((readLen = inputStream.read(buf)) != -1){
            System.out.println(new String(buf,0,readLen));
        }
        //5.è·å–socketç›¸å…³çš„è¾“å‡ºæµ
        OutputStream outputStream = socket.getOutputStream();
        outputStream.write("hello too, client".getBytes());
        socket.shutdownOutput();

        //6.å…³é—­æµå¯¹è±¡å’Œsocket
        outputStream.close();
        inputStream.close();
        socket.close();
        serverSocket.close();

    }

}
```

```java
package com.kun.socket;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.InetAddress;
import java.net.Socket;

public class TcpClient02 {
    public static void main(String[] args) throws IOException {
        //1.è¿æ¥æœåŠ¡å™¨ï¼ˆip + ç«¯å£ï¼‰
        Socket socket = new Socket(InetAddress.getLocalHost(), 9999);
        System.out.println("å®¢æˆ·ç«¯ socketè¿”å›ï¼š"+socket.getClass());
        //2.è¿æ¥æˆåŠŸï¼Œç”Ÿæˆsocket,é€šè¿‡socket.getOutputStream()å¾—åˆ°å’Œsocketç›¸å…³è”çš„è¾“å‡ºæµå¯¹è±¡
        OutputStream outputStream = socket.getOutputStream();
        //3.é€šè¿‡è¾“å‡ºæµï¼Œå†™å…¥æ•°æ®åˆ°æ•°æ®é€šé“
        outputStream.write("hello server".getBytes());
        //è®¾ç½®ç»“æŸæ ‡è®°
        socket.shutdownOutput();
        //4.è·å–socketç›¸å…³è”çš„è¾“å…¥æµå¯¹è±¡ï¼Œè¯»å–æ•°æ®
        InputStream inputStream = socket.getInputStream();
        byte[] buf = new byte[1024];
        int readLen = 0;
        while ((readLen = inputStream.read(buf)) != -1){
            System.out.println(new String(buf,0,readLen));
        }
        //5.å…³é—­æµå¯¹è±¡å’Œsocket
        inputStream.close();
        outputStream.close();
        socket.close();
        System.out.println("å®¢æˆ·ç«¯é€€å‡ºã€‚");
    }
}
```

#### demo3ï¼šåŒå‘é€šä¿¡ï¼ˆä½¿ç”¨å­—ç¬¦æµï¼‰

```java
package com.kun.socket;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;

public class TcpServer03 {

    public static void main(String[] args) throws IOException {
        //1.åœ¨æœ¬æœºçš„9999ç«¯å£ç›‘å¬ï¼Œç­‰å¾…è¿æ¥
        ServerSocket serverSocket = new ServerSocket(9999);
        System.out.println("æœåŠ¡ç«¯ï¼Œåœ¨9999ç«¯å£ç›‘å¬ï¼Œç­‰å¾…è¿æ¥ã€‚ã€‚ã€‚");
        //2.å½“æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥9999ç«¯å£æ—¶ï¼Œç¨‹åºé˜»å¡ï¼Œç­‰å¾…è¿æ¥
        //  å¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›Socketå¯¹è±¡ï¼Œç¨‹åºç»§ç»­
        Socket socket = serverSocket.accept();
        System.out.println("socket = "+ socket.getClass());
        
        //3.é€šè¿‡socket.getInputStream()è¯»å–å®¢æˆ·ç«¯å†™å…¥åˆ°æ•°æ®é€šé“çš„æ•°æ®
        InputStream inputStream = socket.getInputStream();
        //4.IOè¯»å–,ä½¿ç”¨å­—ç¬¦æµ
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
        String s = bufferedReader.readLine();
        System.out.println(s);

        //5.è·å–socketç›¸å…³çš„è¾“å‡ºæµ
        OutputStream outputStream = socket.getOutputStream();
        BufferedWriter bufferedWriter = new BufferedWriter(new OutputStreamWriter(outputStream));
        bufferedWriter.write("hello too,client by writer.");
        bufferedWriter.newLine();  //æ’å…¥ä¸€ä¸ªæ¢è¡Œè¡¨ç¤ºå†™æ•°æ®ç»“æŸ
        bufferedWriter.flush();  //æ‰‹åŠ¨åˆ·æ–°

        //6.å…³é—­æµå¯¹è±¡å’Œsocket
        bufferedReader.close();
        bufferedWriter.close();
        socket.close();
        serverSocket.close();
    }
}
```

```java
package com.kun.socket;

import java.io.*;
import java.net.InetAddress;
import java.net.Socket;

public class TcpClient03 {
    public static void main(String[] args) throws IOException {
        //1.è¿æ¥æœåŠ¡å™¨ï¼ˆip + ç«¯å£ï¼‰
        Socket socket = new Socket(InetAddress.getLocalHost(), 9999);
        System.out.println("å®¢æˆ·ç«¯ socketè¿”å›ï¼š"+socket.getClass());
        //2.è¿æ¥æˆåŠŸï¼Œç”Ÿæˆsocket,é€šè¿‡socket.getOutputStream()å¾—åˆ°å’Œsocketç›¸å…³è”çš„è¾“å‡ºæµå¯¹è±¡
        OutputStream outputStream = socket.getOutputStream();
        //3.é€šè¿‡è¾“å‡ºæµï¼Œå†™å…¥æ•°æ®åˆ°æ•°æ®é€šé“
        BufferedWriter bufferedWriter = new BufferedWriter(new OutputStreamWriter(outputStream));
        bufferedWriter.write("hello server å­—ç¬¦æµ");
        bufferedWriter.newLine(); //æ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦è¡¨ç¤ºå†™å…¥å†…å®¹çš„ç»“æŸï¼Œè¦æ±‚å¯¹æ–¹ä½¿ç”¨readLine()
        bufferedWriter.flush(); //å­—ç¬¦æµéœ€è¦æ‰‹åŠ¨åˆ·æ–°

        //4.è·å–socketç›¸å…³è”çš„è¾“å…¥æµå¯¹è±¡ï¼Œè¯»å–æ•°æ®
        InputStream inputStream = socket.getInputStream();
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
        String s = bufferedReader.readLine();
        System.out.println(s);

        //5.å…³é—­æµå¯¹è±¡å’Œsocket
        bufferedReader.close();
        bufferedWriter.close();
        socket.close();
        System.out.println("å®¢æˆ·ç«¯é€€å‡ºã€‚");
    }
}
```

#### demo4ï¼šTCPå®ç°æ–‡ä»¶ä¸Šä¼ 

æœåŠ¡å™¨ç«¯ï¼š

â€‹		ç¼–å†™ä¸€ä¸ªæœåŠ¡å™¨ç«¯ç¨‹åºï¼Œç”¨æ¥æ¥æ”¶å›¾ç‰‡ã€‚åˆ›å»ºä¸€ä¸ªç›‘å¬æŒ‡å®šç«¯å£å·çš„ServerSocketæœåŠ¡ç«¯å¯¹è±¡ï¼Œåœ¨while(true)æ— é™å¾ªç¯ä¸­æŒç»­è°ƒç”¨ServerSocketçš„accept()æ–¹æ³•æ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ¯å½“å’Œä¸€ä¸ªå®¢æˆ·ç«¯å»ºç«‹è¿æ¥åï¼Œå°±å¼€å¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹å’Œè¿™ä¸ªå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ã€‚åœ¨å¤„ç†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„ServerThreadçº¿ç¨‹ç®¡ç†ç±»ä¸­ï¼Œå…ˆè¿›è¡Œå®¢æˆ·ç«¯æ–‡ä»¶ä¸Šä¼ ä¿å­˜å¤„ç†ï¼Œç¡®å®šäº†æ–‡ä»¶ä¿å­˜ç›®å½•å’Œæ–‡ä»¶å‘½åæ–¹å¼ï¼Œç„¶åè¿›è¡Œä¿å­˜å¤„ç†ï¼Œæœ€ååˆé€šè¿‡å®¢æˆ·ç«¯è¾“å‡ºæµï¼Œå‘å®¢æˆ·ç«¯è¾“å‡ºâ€œä¸Šä¼ æˆåŠŸâ€çš„ä¿¡æ¯è¿›è¡Œå“åº”ã€‚ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡å™¨ç«¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚

```java
package com.kun.tcpupload;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.ServerSocket;
import java.net.Socket;

class ServerThread implements Runnable {
    private Socket socket;
    public ServerThread(Socket socket) {
        this.socket = socket;
    }
    public void run() {
        String ip = socket.getInetAddress().getHostAddress();
        int count = 1;
        try {
            File parentFile = new File("NetDemo\\src\\com\\kun\\tcpupload\\");
            if (!parentFile.exists()) {
                parentFile.mkdir();
            }
            File file = new File(parentFile, ip + "(" + count + ").jpg");
            while  (file.exists()) {
                file = new File(parentFile, ip + "(" + (count++) + ").jpg");
            }
            InputStream in = socket.getInputStream();
            FileOutputStream fos = new FileOutputStream(file);
            byte[] buf = new byte[1024];
            int len = 0;
            while ((len = in.read(buf)) != -1) {
                fos.write(buf, 0, len);
            }
            OutputStream out = socket.getOutputStream();
            out.write("ä¸Šä¼ æˆåŠŸ".getBytes());
            in.close();
            fos.close();
            socket.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

public class UploadTcpServer {
    public static void main(String[] args) throws Exception {
        @SuppressWarnings("resource")
        ServerSocket serverSocket = new ServerSocket(10001);
        while (true) {
            Socket client = serverSocket.accept();
            new Thread(new ServerThread(client)).start();
        }
    }
}
```

å®¢æˆ·ç«¯ï¼š	

  	åˆ›å»ºäº†Socketå¯¹è±¡ï¼ŒæŒ‡å®šè¿æ¥æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ï¼Œç„¶ååˆ†åˆ«é€šè¿‡Socketçš„è¾“å‡ºæµå¯¹è±¡å‘æœåŠ¡ç«¯ä¸Šä¼ å›¾ç‰‡å’Œè¾“å…¥æµå¯¹è±¡è·å–æœåŠ¡ç«¯å“åº”ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œå‘æœåŠ¡ç«¯ä¸Šä¼ çš„æºå›¾ç‰‡åœ°å€ä¸ºD:\\Test\\a.jpg,å³Dç›˜æ ¹ç›®å½•ä¸‹çš„a.jpgå›¾ç‰‡ï¼Œåœ¨ä¸Šä¼ ä¹‹å‰ä¸€å®šè¦ç¡®ä¿å›¾ç‰‡å­˜åœ¨ã€‚å¦å¤–ï¼Œåœ¨å‘æœåŠ¡ç«¯ä¸Šä¼ å®Œæ¯•å›¾ç‰‡åè¦è°ƒç”¨Socketçš„shutDownOutput()æ–¹æ³•ã€‚å…³é—­å®¢æˆ·ç«¯çš„è¾“å‡ºæµã€‚

```java
package com.kun.tcpupload;
import java.io.FileInputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.InetAddress;
import java.net.Socket;

public class UploadTcpClient {
    public static void main(String[] args) throws Exception {
        Socket client = new Socket(InetAddress.getLocalHost(),10001);
        OutputStream out = client.getOutputStream();
        FileInputStream fis = new FileInputStream("D:\\Test\\a.jpg");
        byte[] buf = new byte[1024];
        int len= 0;
        System.out.println("è¿æ¥åˆ°æœåŠ¡å™¨ç«¯ï¼Œå¼€å§‹æ–‡ä»¶ä¸Šä¼ ï¼");
        while ((len = fis.read(buf)) != -1) {
            out.write(buf, 0, len);
        }
        client.shutdownOutput();
        InputStream is = client.getInputStream();
        byte[] bufMsg= new byte[1024];
        int len2 = is.read(bufMsg);
        while (len2 != -1){
            System.out.println(new String(bufMsg, 0, len2));
            len2 = is.read(bufMsg);
        }
        out.close();
        is.close();
        fis.close();
        client.close();
    }
}
```

ä¸Šä¼ æˆåŠŸï¼š

![image-20210521170607758](https://gitee.com/Kunaly/picture-bed/raw/master/img/image-20210521170607758.png)



### 2.5 UDP é€šä¿¡çš„ä¾‹å­

**UDPç®€ä»‹ï¼š**

- UDPåè®®çš„å…¨ç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®æŠ¥ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼ŒUDPä½äºç¬¬å››å±‚â€”â€”ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®é¢ä¸Šä¸€å±‚ã€‚UDPæœ‰ä¸æä¾›æ•°æ®æŠ¥åˆ†ç»„ã€ç»„è£…ä»¥åŠä¸èƒ½å¯¹æ•°æ®æŠ¥æ’åºçš„ç¼ºç‚¹ã€‚å½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾çš„ã€‚

- ç”±äºUDPä¸å±äºè¿æ¥æ€§åè®®çš„ç‰¹æ€§ï¼Œå› æ­¤å…·æœ‰èµ„æºæ¶ˆè€—å°ã€å¤„ç†é€Ÿåº¦å¿«çš„ä¼˜ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡éŸ³é¢‘ã€è§†é¢‘å’Œæ™®é€šæ•°æ®åœ¨ä¼ é€æ—¶ä½¿ç”¨UDPè¾ƒå¤šï¼Œå› ä¸ºå®ƒä»¬å³ä½¿å¶å°”ä¸¢å¤±ä¸€ä¸¤ä¸ªæ•°æ®åŒ…ï¼Œä¹Ÿä¸ä¼šå¯¹æ¥æ”¶ç»“æœäº§ç”Ÿå¤ªå¤§å½±å“ã€‚

- ä½¿ç”¨java.netåŒ…ä¸‹çš„DatagramSocketå’ŒDatagramPacketç±»ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°æ§åˆ¶ç”¨æˆ·æ•°æ®æŠ¥æ–‡ã€‚ä¸‹é¢å°±å¯¹è¿™ä¸¤ä¸ªç±»è¿›è¡Œæ¡ˆä¾‹ä»‹ç»

  **DatagramPacket**
  	è¡¨ç¤ºæ•°æ®æŠ¥åŒ…ï¼Œç”¨æ¥å®ç°æ— è¿æ¥çš„åŒ…çš„æŠ•é€’æœåŠ¡ã€‚è¿™äº›æ•°æ®åŒ…é€‰æ‹©ä¸åŒçš„è·¯ç”±ï¼Œç»è¿‡è®¡ç®—æœºçš„å­˜å‚¨è½¬å‘ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®çš„è®¡ç®—æœºã€‚æ‰€ä»¥åˆ°è¾¾çš„æ•°æ®åŒ…å’Œå‘é€æ—¶çš„é¡ºåºä¸ä¸€å®šä¼šç›¸åŒã€‚

> åˆ©ç”¨UDPé€šä¿¡åŠŸèƒ½ï¼Œç”¨DatagramPacketç±»ä¸DatagramSocketç±»çš„å¸¸ç”¨æ–¹æ³•ï¼Œæ¨¡æ‹Ÿå®ç°ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„èŠå¤©ç¨‹åºã€‚

#### demo1ï¼šUDPåŒå‘é€šä¿¡

```java
package com.kun.udp;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;

/**
 * UDPæœåŠ¡å™¨ç«¯
 */
public class UdpServer01 {
    public static void main(String[] args) throws IOException {
        /*
         * æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®
         */
        // 1.åˆ›å»ºæœåŠ¡å™¨ç«¯DatagramSocketï¼ŒæŒ‡å®šç«¯å£
        DatagramSocket socket = new DatagramSocket(8800);
        // 2.åˆ›å»ºæ•°æ®æŠ¥ï¼Œç”¨äºæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®
        byte[] data = new byte[1024];// åˆ›å»ºå­—èŠ‚æ•°ç»„ï¼ŒæŒ‡å®šæ¥æ”¶çš„æ•°æ®åŒ…çš„å¤§å°
        DatagramPacket packet = new DatagramPacket(data, data.length);
        // 3.æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®
        System.out.println("****æœåŠ¡å™¨ç«¯å·²ç»å¯åŠ¨ï¼Œç­‰å¾…å®¢æˆ·ç«¯å‘é€æ•°æ®");
        socket.receive(packet);// æ­¤æ–¹æ³•åœ¨æ¥æ”¶åˆ°æ•°æ®æŠ¥ä¹‹å‰ä¼šä¸€ç›´é˜»å¡
        // 4.è¯»å–æ•°æ®
        String info = new String(data, 0, packet.getLength());
        System.out.println("æˆ‘æ˜¯æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯è¯´ï¼š" + info);

        /*
         * å‘å®¢æˆ·ç«¯å“åº”æ•°æ®
         */
        // 1.å®šä¹‰å®¢æˆ·ç«¯çš„åœ°å€ã€ç«¯å£å·ã€æ•°æ®
        InetAddress address = packet.getAddress();
        int port = packet.getPort();
        byte[] data2 = "æ¬¢è¿æ‚¨!".getBytes();
        // 2.åˆ›å»ºæ•°æ®æŠ¥ï¼ŒåŒ…å«å“åº”çš„æ•°æ®ä¿¡æ¯
        DatagramPacket packet2 = new DatagramPacket(data2, data2.length, address, port);
        // 3.å“åº”å®¢æˆ·ç«¯
        socket.send(packet2);
        // 4.å…³é—­èµ„æº
        socket.close();
    }
}
```

```java
package com.kun.udp;
import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;

/*
 * å®¢æˆ·ç«¯
 */
public class UdpClient01 {
    public static void main(String[] args) throws IOException {
        /*
         * å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®
         */
        // 1.å®šä¹‰æœåŠ¡å™¨çš„åœ°å€ã€ç«¯å£å·ã€æ•°æ®
        InetAddress address = InetAddress.getByName("localhost");
        int port = 8800;
        byte[] data = "ç”¨æˆ·åï¼šadmin;å¯†ç ï¼š123".getBytes();
        // 2.åˆ›å»ºæ•°æ®æŠ¥ï¼ŒåŒ…å«å‘é€çš„æ•°æ®ä¿¡æ¯
        DatagramPacket packet = new DatagramPacket(data, data.length, address, port);
        // 3.åˆ›å»ºDatagramSocketå¯¹è±¡
        DatagramSocket socket = new DatagramSocket();
        // 4.å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®æŠ¥
        socket.send(packet);

        /*
         * æ¥æ”¶æœåŠ¡å™¨ç«¯å“åº”çš„æ•°æ®
         */
        // 1.åˆ›å»ºæ•°æ®æŠ¥ï¼Œç”¨äºæ¥æ”¶æœåŠ¡å™¨ç«¯å“åº”çš„æ•°æ®
        byte[] data2 = new byte[1024];
        DatagramPacket packet2 = new DatagramPacket(data2, data2.length);
        // 2.æ¥æ”¶æœåŠ¡å™¨å“åº”çš„æ•°æ®
        socket.receive(packet2);
        // 3.è¯»å–æ•°æ®
        String reply = new String(data2, 0, packet2.getLength());
        System.out.println("æˆ‘æ˜¯å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨è¯´ï¼š" + reply);
        // 4.å…³é—­èµ„æº
        socket.close();
    }
}
```

#### demo2ï¼šUDPèŠå¤©å®¤

1. å®ç°èŠå¤©çª—å£ç•Œé¢ï¼Œé¦–å…ˆåˆ›å»ºä¸¤ä¸ªåç§°ä¸ºChatRoom1å’ŒChatRoom2çš„ç¨‹åºå…¥å£ç±»,åœ¨è¯¥ç±»çš„main()æ–¹æ³•ä¸­è·å–å½“å‰æœåŠ¡æ‰€åœ¨ç«¯å£å·ã€èŠå¤©å¯¹è±¡æœåŠ¡æ‰€åœ¨ç«¯å£å·,å¹¶åˆ›å»ºDatagramSocketä¿¡æ¯æ”¶å‘å¯¹è±¡,ä»¥åŠé€šè¿‡å¤šçº¿ç¨‹å®ç°å‘é€ç«¯å’Œæ¥æ”¶ç«¯åŠŸèƒ½,å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

```java
package com.kun.udp.chat;

import java.net.DatagramSocket;
import java.net.SocketException;
import java.util.Scanner;

/**
 * å®ç°èŠå¤©çª—å£ç•Œé¢ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªåç§°ä¸ºChatRoomçš„ç¨‹åºå…¥å£ç±»,
 * åœ¨è¯¥ç±»çš„main()æ–¹æ³•ä¸­è·å–å½“å‰æœåŠ¡æ‰€åœ¨ç«¯å£å·ã€èŠå¤©å¯¹è±¡æœåŠ¡æ‰€åœ¨ç«¯å£å·,
 * å¹¶åˆ›å»ºDatagramSocketä¿¡æ¯æ”¶å‘å¯¹è±¡,ä»¥åŠé€šè¿‡å¤šçº¿ç¨‹å®ç°å‘é€ç«¯å’Œæ¥æ”¶ç«¯åŠŸèƒ½
 */
public class ChatRoom1 {
    public static void main(String[] args) {
        @SuppressWarnings("resource")
        Scanner sc = new Scanner(System.in);
        System.out.print("è¯·è¾“å…¥èŠå¤©æœåŠ¡å½“å‰å¯åŠ¨ç«¯å£å·ï¼š");
        int serverPort = sc.nextInt();
        System.out.print("è¯·è¾“å…¥èŠå¤©æœåŠ¡å‘é€ä¿¡æ¯å¯¹è±¡çš„ç›®æ ‡ç«¯å£å·ï¼š");
        int targetPort = sc.nextInt();
        System.out.println("èŠå¤©ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆå¹¶å¯åŠ¨ï¼ï¼ï¼");
        try {
            DatagramSocket socket = new DatagramSocket(serverPort);
            new Thread(new ChatReceiver(socket), "æ¥æ”¶æœåŠ¡").start();
            new Thread(new ChatSend(socket,targetPort),"å‘é€æœåŠ¡").start();
        } catch (SocketException e) {
            e.printStackTrace();
        }
    }
}
```

```java
package com.kun.udp.chat;

import java.net.DatagramSocket;
import java.net.SocketException;
import java.util.Scanner;

/**
 * å®ç°èŠå¤©çª—å£ç•Œé¢ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªåç§°ä¸ºChatRoomçš„ç¨‹åºå…¥å£ç±»,
 * åœ¨è¯¥ç±»çš„main()æ–¹æ³•ä¸­è·å–å½“å‰æœåŠ¡æ‰€åœ¨ç«¯å£å·ã€èŠå¤©å¯¹è±¡æœåŠ¡æ‰€åœ¨ç«¯å£å·,
 * å¹¶åˆ›å»ºDatagramSocketä¿¡æ¯æ”¶å‘å¯¹è±¡,ä»¥åŠé€šè¿‡å¤šçº¿ç¨‹å®ç°å‘é€ç«¯å’Œæ¥æ”¶ç«¯åŠŸèƒ½
 */
public class ChatRoom2 {
    public static void main(String[] args) {
        @SuppressWarnings("resource")
        Scanner sc = new Scanner(System.in);
        System.out.print("è¯·è¾“å…¥èŠå¤©æœåŠ¡å½“å‰å¯åŠ¨ç«¯å£å·ï¼š");
        int serverPort = sc.nextInt();
        System.out.print("è¯·è¾“å…¥èŠå¤©æœåŠ¡å‘é€ä¿¡æ¯å¯¹è±¡çš„ç›®æ ‡ç«¯å£å·ï¼š");
        int targetPort = sc.nextInt();
        System.out.println("èŠå¤©ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆå¹¶å¯åŠ¨ï¼ï¼ï¼");
        try {
            DatagramSocket socket = new DatagramSocket(serverPort);
            new Thread(new ChatReceiver(socket), "æ¥æ”¶æœåŠ¡").start();
            new Thread(new ChatSend(socket,targetPort),"å‘é€æœåŠ¡").start();
        } catch (SocketException e) {
            e.printStackTrace();
        }
    }
}
```

2. å®ç°èŠå¤©ç¨‹åºå‘é€ä¿¡æ¯åŠŸèƒ½ã€‚åˆ›å»ºä¸€ä¸ªChatSendç±»ï¼Œä½œä¸ºèŠå¤©ç¨‹åºçš„å‘é€ç«¯ï¼Œç”¨äºå‘æŒ‡å®šçš„èŠå¤©ç¨‹åºå‘é€èŠå¤©ä¿¡æ¯ã€‚å…·ä½“å¦‚ä¸‹å›¾ï¼š

```java
package com.kun.udp.chat;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.util.Scanner;

/**
 * å®ç°èŠå¤©ç¨‹åºå‘é€ä¿¡æ¯åŠŸèƒ½
 */
public class ChatSend implements Runnable {
    private DatagramSocket client;
    private int targetPort;
    public ChatSend(DatagramSocket client,int targetPort) {
        this.client = client;
        this.targetPort = targetPort;
    }
    public void run() {
        try {
            @SuppressWarnings("resource")
            Scanner sc = new Scanner(System.in);
            while (true) {
                String data = sc.nextLine();
                byte[] buf = data.getBytes();
                DatagramPacket packet = new DatagramPacket(buf, buf.length,
                        InetAddress.getByName("127.0.0.255"),targetPort);
                client.send(packet);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

3. å®ç°èŠå¤©ç¨‹åºæ¥æ”¶ä¿¡æ¯åŠŸèƒ½ã€‚åˆ›å»ºä¸€ä¸ªChatReceiverç±»ä½œä¸ºèŠå¤©ç¨‹åºçš„æ¥æ”¶ç«¯ï¼Œç”¨äºæ¥æ”¶å…¶ä»–ç”¨æˆ·å‘é€çš„èŠå¤©ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:

```java
package com.kun.udp.chat;

import java.net.DatagramPacket;
import java.net.DatagramSocket;

/**
 * å®ç°èŠå¤©ç¨‹åºæ¥æ”¶ä¿¡æ¯åŠŸèƒ½
 */
public class ChatReceiver implements Runnable {
    private DatagramSocket server;
    public ChatReceiver(DatagramSocket server) {
        this.server = server;
    }
    public void run() {
        try {
            byte[] buf = new byte[1024];
            DatagramPacket packet = new DatagramPacket(buf, buf.length);
            while (true) {
                server.receive(packet);
                String str = new String(packet.getData(), 0, packet.getLength());
                System.out.println("æ”¶åˆ°" + packet.getAddress()+":"+packet.getPort()+ " å‘é€çš„æ•°æ®:" + str);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

åˆ†åˆ«å¯åŠ¨ChatRoom1å’ŒChatRoom2ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![image-20210521172117519](https://gitee.com/Kunaly/picture-bed/raw/master/img/image-20210521172117519.png)![image-20210521172129286](https://gitee.com/Kunaly/picture-bed/raw/master/img/image-20210521172129286.png)

## ğŸ“š References

- https://www.cnblogs.com/gh110/p/12158125.html
- https://blog.csdn.net/weixin_42882887/article/details/86598410

  

